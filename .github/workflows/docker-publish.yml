name: Release version

on:
  push:
    branches: [ development, release-* ]

env:
  IMAGE_NAME: ${{ github.repository }}

jobs:
  build_and_publish:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      packages: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Codestyle
        id: semantic
        run: |
          # Get the current branch name
          CURRENT_BRANCH=$(git symbolic-ref -q HEAD)
          CURRENT_BRANCH=${CURRENT_BRANCH##refs/heads/}
          CURRENT_BRANCH=${CURRENT_BRANCH:-HEAD}
          echo "Current branch: $CURRENT_BRANCH"

          # Get a list of all tags in the repository
          git fetch --prune --unshallow --tags
          TAG_LIST=$(git tag)
          echo "Available tags: $TAG_LIST"

          # Get the messages of the last three commits on the current branch
          COMMIT_MESSAGES=$(git log --pretty=format:%s -n 1)
          echo "Last commit message:"
          echo "$COMMIT_MESSAGES"
          #- uses: docker://ghcr.io/codfish/semantic-release-action@sha256:4675eae74abbabc869298ca798833fef291ce30fb9edfac76787746e7d9d3904
          #  id: semantic
          #  with:
          #    branches: |
          #      [
          #        'release-*',
          #        {
          #          name: 'development',
          #          prerelease: true
          #        }
          #      ]
          #    additional_packages: |
          #      [
          #        "@semantic-release/changelog",
          #        "@semantic-release/git"
          #      ]
          #    plugins: |
          #      [
          #        "@semantic-release/commit-analyzer",
          #        "@semantic-release/changelog",
          #        "@semantic-release/git",
          #        "@semantic-release/github",
          #        "@semantic-release/release-notes-generator"
          #      ]
          #    dry_run: false
          #  env:
          #    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

            #- name: Login to GitHub Container Registry
            #  uses: docker/login-action@465a07811f14bebb1938fbed4728c6a1ff8901fc
            #  with:
            #    registry: ghcr.io
            #    username: ${{ github.actor }}
            #    password: ${{ secrets.GITHUB_TOKEN }}

            #- name: Build and push Docker image
            #  uses: docker/build-push-action@2eb1c1961a95fc15694676618e422e8ba1d63825
            #  with:
            #    context: .
            #    push: true
            #    tags: ghcr.io/${{ env.IMAGE_NAME }}:${{ steps.semantic.outputs.release-version }}
            #    labels: ${{ steps.meta.outputs.labels }}
            #    build-args: |
            #      VERSION=${{ steps.semantic.outputs.release-version }}

            #- name: Publish tag
            #  uses: rickstaa/action-create-tag@07b918ecbf94359b859f25f7a70553a84e804923
            #  with:
            #    tag: ${{ steps.semantic.outputs.release-version }}
            #    message: |
            #      ${{ steps.semantic.outputs.name }}

            #      ${{ steps.semantic.outputs.release-notes }}
            #    #TODO: force_push_tag is true for debug purpose only
            #    force_push_tag: true

